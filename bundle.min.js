(()=>{var e={161:(e,s,t)=>{const n=t(344),{SECRET_KEY:o}=t(929);e.exports=class{static secretKey=o;static generateToken(e){return n.sign(e,this.secretKey)}static decode(e){try{return n.verify(e,this.secretKey)}catch(e){return null}}}},929:e=>{const s=process.env.JWT_SECRET_KEY;e.exports={SECRET_KEY:s}},789:(e,s,t)=>{const n=t(185),{DB_URL:o}=t(301);n.set("strictQuery",!0);const r=t(910);n.connection.on("connected",function(){console.log("Connected to mongo")}),n.connection.on("error",e=>{console.log("Mongo connection ERROR",e)});const c=new class{constructor(){}async connectDatabase(){await n.connect(o,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(async()=>{console.log("DB init")})}async createUser(e){const{nick:s,money:t,passwordHash:n}=e,o=new r({nick:s,money:t,passwordHash:n});return await o.save().then(e=>{console.log("User saved in database")}).catch(e=>{console.log(e+" User NOT saved in database")}),!0}updateUser(e){return r.updateOne({id:e.id},{$set:{score:e.score}})}async findUser(e){return r.findOne(e).select("-_id -passwordHash -__v").lean()}downloadUser(e){return this.findUser(e).then(e=>e||"User does not exist")}downloadUsers(){return r.find({})}};e.exports=c},301:(e,s,t)=>{t(142).config();const n=process.env.USERNAME,o=process.env.PASSWORD,r=process.env.HOST,c=process.env.DB_URL;e.exports={DB_URL:c,USERNAME:n,PASSWORD:o,HOST:r}},910:(e,s,t)=>{const n=t(185),o=new n.Schema({passwordHash:String,money:Number,payment:{id:String}});e.exports=n.model("Users",o)},174:(e,s,t)=>{const n=t(813),{CLIENT_ID:o,CLIENT_SECRET:r,MODE:c,SERVER_URL:a}=t(168),i=new class{constructor(){this.configurePayPal()}configurePayPal(){n.configure({mode:c,client_id:o,client_secret:r})}createPaymentJSON(e,s){return{intent:"sale",payer:{payment_method:"paypal"},redirect_urls:{return_url:`${a}/success?price=${e}&purchasedCoinsCount=${s}`,cancel_url:`${a}/cancel`},transactions:[{item_list:{items:[{name:"Coins",sku:"ITEM",price:e,currency:"USD",quantity:1}]},amount:{currency:"USD",total:e},description:"Buying game coins"}]}}createPayment(e,s){n.payment.create(e,async(e,t)=>{await s(e,t)})}executePaymentJSON(e,s){return{payer_id:e,transactions:[{amount:{currency:"USD",total:s}}]}}executePayment(e,s,t){n.payment.execute(e,s,async(e,s)=>{t(e,s)})}};e.exports=i},168:(e,s,t)=>{const{port:n}=t(10),o=`http://localhost:${n}`;e.exports={CLIENT_ID:"ARTefP79Apg2DPlakJ3JjNxFUDKJ2KWIj9WYUJf5QIXiw9hl8PwGJyLyhVWANUqp3jY9hp2ACV_E9Mdq",CLIENT_SECRET:"EOQ_jZdpe2hngWyR4YrwKmggio67_pih7fWfmp-KgRkqbAC9O2a8-FW5sKq6nCqsT6Pyioey8Ku_LvOB",MODE:"sandbox",SERVER_URL:o}},766:e=>{e.exports={SERVER_PORT:8081,SOCKET_PORT:2567}},537:(e,s,t)=>{const n=t(789),o=t(816),r=t(161);e.exports=async function(e,s){const{username:t,password:c}=e.body,a=String(t),i=String(c);try{const e=a+i,t=await o.hashPassword(e);if(!await n.findUser({passwordHash:t}))return console.log("User does not exist in database"),s.status(404).json({success:!1,token:null});console.log("User exists in database");const c=r.generateToken(t);return s.json({success:!0,jwt:c})}catch(e){return console.error("An error occurred during registration",e),s.status(500).json({success:!1,error:"Internal server error"})}}},899:(e,s,t)=>{const n=t(400),o=t(537);e.exports={registration:n,authentication:o}},400:(e,s,t)=>{const n=t(789),o=t(816);function r(e){return!("number"==typeof e&&!isNaN(e)||"string"==typeof e&&""!==e.trim())}e.exports=async function(e,s){const{username:t,password:c,nick:a}=e.body;try{const e=t+c;if(function(e,s,t){const n=r(e),o=r(s),c=r(t);return n&&o&&c}(t,c,a))return console.log("one of the login characters is empty"),s.status(404).json({success:!1,token:null});const i=await o.hashPassword(e);if(await n.findUser({passwordHash:i}))return console.log("User password hash exists in database"),s.status(404).json({success:!1});console.log("User password hash  does not exist in database");const d={nick:a,money:0,passwordHash:i};return n.createUser(d),s.json({success:!0})}catch(e){return console.error("An error occurred during registration",e),s.status(500).json({success:!1,error:"Internal server error"})}}},382:e=>{e.exports=function(e,s){console.log("PAYMENT CANCEL")}},422:(e,s,t)=>{const n=t(635),o=t(174),r=t(789);e.exports=function(e,s){const{clientToken:t,orderNumber:c}=e.body,{price:a,purchasedCoinsCount:i}=function(e){if(!n.has(e))throw new Error("Invalid order number");return n.get(e)}(c),d=loginToken.decode(t).accountID,l=o.createPaymentJSON(a,i);o.createPayment(l,async(e,t)=>{if(e)console.error(e);else{const e=t.links.find(e=>"approval_url"===e.rel).href,n=t.id;await r.updatePaymentId({decodedToken:d,paymentId:n}),s.json({redirectUrl:e})}})}},683:(e,s,t)=>{const n=t(422),o=t(217),r=t(382);e.exports={createPayment:n,success:o,cancel:r}},217:(e,s,t)=>{const n=t(789),o=t(174);e.exports=async function(e,s){const t=e.query.PayerID,r=e.query.paymentId,c=e.query.price,a=e.query.purchasedCoinsCount,i=o.executePaymentJSON(t,c);o.executePayment(r,i,async(e,s)=>{if(e)throw console.log(e.response),e;{const e=await n.downloadPlayer({paymentId:r}),{money:s,accountID:t}=e,o=s+Number(a);await async function(e,s){await n.updatePlayer({accountID:e,money:s})}(t,o),console.log("PAYMENT SUCCESS")}})}},816:(e,s,t)=>{const n=t(113),{SPECIAL_SIGN:o}=t(864),r=new class{constructor(){this.specialSign=o}hashPassword(e){return n.createHash("sha256").update(e+this.specialSign).digest("hex")}};e.exports=r},864:e=>{const s=process.env.PASSWORD_HASHER_SPECIAL_SIGN;e.exports={SPECIAL_SIGN:s}},487:e=>{e.exports={SERVER_PORT:8081,ROWS:4,COLUMNS:5,SYMBOL_TEXTURE_COUNT:11,REEL_POSITIONS:[0,130,260,390,520]}},209:e=>{e.exports=[{symbolsCoordinates:[[0,0],[1,0],[2,0],[3,0],[4,0]],symbolsIndex:[0,0,0,0,0],lineIndex:0},{symbolsCoordinates:[[0,1],[1,1],[2,1],[3,1],[4,1]],symbolsIndex:[1,1,1,1,1],lineIndex:1},{symbolsCoordinates:[[0,2],[1,2],[2,2],[3,2],[4,2]],symbolsIndex:[2,2,2,2,2],lineIndex:2},{symbolsCoordinates:[[0,0],[1,1],[2,2],[3,1],[4,0]],symbolsIndex:[0,1,2,1,0],lineIndex:3},{symbolsCoordinates:[[0,2],[1,1],[2,0],[3,1],[4,2]],symbolsIndex:[2,1,0,1,2],lineIndex:4},{symbolsCoordinates:[[0,1],[1,0],[2,1],[3,0],[4,1]],symbolsIndex:[1,0,1,0,1],lineIndex:5},{symbolsCoordinates:[[0,1],[1,2],[2,1],[3,2],[4,1]],symbolsIndex:[1,2,1,2,1],lineIndex:6},{symbolsCoordinates:[[0,0],[1,0],[2,1],[3,2],[4,2]],symbolsIndex:[0,0,1,2,2],lineIndex:7},{symbolsCoordinates:[[0,2],[1,2],[2,1],[3,0],[4,0]],symbolsIndex:[2,2,1,0,0],lineIndex:8},{symbolsCoordinates:[[0,1],[1,2],[2,1],[3,0],[4,1]],symbolsIndex:[1,2,1,0,1],lineIndex:9},{symbolsCoordinates:[[0,1],[1,0],[2,1],[3,2],[4,1]],symbolsIndex:[1,0,1,2,1],lineIndex:10},{symbolsCoordinates:[[0,0],[1,1],[2,1],[3,1],[4,0]],symbolsIndex:[0,1,1,1,0],lineIndex:11},{symbolsCoordinates:[[0,2],[1,1],[2,1],[3,1],[4,2]],symbolsIndex:[2,1,1,1,2],lineIndex:12},{symbolsCoordinates:[[0,0],[1,1],[2,0],[3,1],[4,0]],symbolsIndex:[0,1,0,1,0],lineIndex:13},{symbolsCoordinates:[[0,2],[1,1],[2,2],[3,1],[4,2]],symbolsIndex:[2,1,2,1,2],lineIndex:14},{symbolsCoordinates:[[0,1],[1,1],[2,0],[3,1],[4,1]],symbolsIndex:[1,1,0,1,1],lineIndex:15},{symbolsCoordinates:[[0,1],[1,1],[2,2],[3,1],[4,1]],symbolsIndex:[1,1,2,1,1],lineIndex:16},{symbolsCoordinates:[[0,0],[1,0],[2,2],[3,0],[4,0]],symbolsIndex:[0,0,2,0,0],lineIndex:17},{symbolsCoordinates:[[0,2],[1,2],[2,0],[3,2],[4,2]],symbolsIndex:[2,2,0,2,2],lineIndex:18},{symbolsCoordinates:[[0,0],[1,2],[2,2],[3,2],[4,0]],symbolsIndex:[0,2,2,2,0],lineIndex:19}]},389:(e,s,t)=>{const{ROWS:n,COLUMNS:o,SYMBOL_TEXTURE_COUNT:r,REEL_POSITIONS:c}=t(487),a=t(831),i=t(655),d=t(147),l=t(209);t(161),e.exports=class{static async userSpinAction(e,s){let t={};try{const{bet:n,authToken:o}=s,r=this.getUser(e),{credits:c}=r.data;if(this.checkIfThePlayerHasEnoughMoney(c,n))t.success=!1;else{const e=this.getRandomSymbolsTextureIndexes(),s=this.checkHorizontalMatches(e),o=this.checkVerticalMatches(e),a=this.calculateTotalCreditsWin(s.symbolIndexes,n),i=c-n+a;r.credits=i,t={symbolTextureIndexes:e,creditsBalance:i,horizontalMatches:s,verticalMatches:o,totalCreditsWin:a}}}catch(e){console.error("An error occurred:",e),t.error="Internal Server Error"}return t}static getRandomSymbolsTextureIndexes(){const e=[];for(let s=0;s<o;s++){e[s]=[];for(let t=0;t<n-1;t++){const n=d.getRandomNumberFloor(0,r-1);e[s][t]=n}}return e}static calculateTotalCreditsWin(e,s){return s*e.length}static calculateTotalWinMoney(e,s,t){return e-s+t}static checkIfThePlayerHasEnoughMoney(e,s){return e-s<0||e<0||s<100||s>e}static createNewUser(e){const s=new i;a.addUser(e,s)}static getUserState(e){return a.getUser(e).getData()}static getUser(e){return a.getUser(e)}static deleteUser(e){a.deleteUser(e)}static checkHorizontalMatches(e){const s={symbolIndexes:[],lineIndexes:[]};for(const t of l){const n=t.symbolsCoordinates.map(([s,t])=>e[s][t]),o=n.every(e=>e===n[0]);if(o||n.includes(7)||n.includes(10)||n.includes(9)){const e=n.filter(e=>7!==e&&10!==e&&9!==e),r=e.every(s=>s===e[0]);(o||r)&&(s.symbolIndexes.push(t.symbolsIndex),s.lineIndexes.push(t.lineIndex))}}return s}static checkVerticalMatches(e){let s=[];for(let t=0;t<o;t++)if(e[t][0]===e[t][1]&&e[t][0]===e[t][2]){let e=c[t];s.push(e)}return s}}},635:e=>{const s=new Map([[1,{price:"50.00",purchasedCoinsCount:50}],[2,{price:"100.00",purchasedCoinsCount:100}],[3,{price:"150.00",purchasedCoinsCount:150}],[4,{price:"200.00",purchasedCoinsCount:200}],[5,{price:"300.00",purchasedCoinsCount:500}],[6,{price:"500.00",purchasedCoinsCount:1e3}]]);e.exports=s},655:e=>{e.exports=class{constructor(){this.data={credits:1e7}}get credits(){return this.data.credits}getData(){return this.data}set credits(e){this.data.credits=e}}},831:e=>{e.exports=new class{constructor(){this.users={}}addUser(e,s){this.users[e]=s}getUser(e){return this.users[e]}deleteUser(e){delete this.users[e]}}},147:e=>{e.exports=class{static getRandomNumberFloor(e,s){return Math.floor(Math.random()*(s-e+1))+e}static getRandomNumber(e,s){return Math.random()*(s-e+1)+e}}},10:(e,s,t)=>{const{SERVER_PORT:n}=t(766),o=t(685),r=t(455),c=t(860),a=c(),i=o.createServer(a),d=t(582),l=process.env.PORT||n,u=t(952)(i,{cors:{origin:"*"}});a.use(d({origin:"*"})),a.use(r()),a.use(c.json()),a.use(c.static(`${__dirname}/../client`)),a.get("/",function(e,s){s.sendFile(__dirname+"/index.html")}),e.exports={server:i,app:a,port:l,socketServer:u}},455:e=>{"use strict";e.exports=require("compression")},582:e=>{"use strict";e.exports=require("cors")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},185:e=>{"use strict";e.exports=require("mongoose")},813:e=>{"use strict";e.exports=require("paypal-rest-sdk")},952:e=>{"use strict";e.exports=require("socket.io")},113:e=>{"use strict";e.exports=require("crypto")},685:e=>{"use strict";e.exports=require("http")}},s={};function t(n){var o=s[n];if(void 0!==o)return o.exports;var r=s[n]={exports:{}};return e[n](r,r.exports,t),r.exports}(()=>{const{app:e,server:s,port:n,socketServer:o}=t(10),r=t(389),{authentication:c,registration:a}=t(899),{createPayment:i,success:d,cancel:l}=t(683);s.listen(n,async()=>{e.post("/authentication",c),e.post("/registration",a),o.on("connection",e=>{console.log("new user"),r.createNewUser(e.id),e.once("getUserState",s=>{const t=r.getUserState(e.id,s);e.emit("userState",t)}),e.on("spinAction",async s=>{const t=await r.userSpinAction(e.id,s);e.emit("updateGameData",t)}),e.on("disconnect",()=>{console.log(`user ${e.id} disconect`),r.deleteUser(e.id)})}),console.log(`Listening on ${s.address().port}`)})})()})();